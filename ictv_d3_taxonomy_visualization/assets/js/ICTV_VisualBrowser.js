(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{AppSettings:()=>n,CuratedNameType:()=>Xn,IdParameterName:()=>Un,IdentifierPrefix:()=>Wn,IdentifierType:()=>zn,JobStatus:()=>Yn,LookupIdParameterType:()=>or,LookupNameClass:()=>sr,LookupNameClassDefinition:()=>ur,LookupReleaseAction:()=>lr,LookupReleaseActionDefinition:()=>cr,LookupTaxonomyRank:()=>hr,NameClass:()=>Gn,OrderedTaxaLevel:()=>Fn,ReleaseAction:()=>Kn,SearchModifier:()=>Jn,TaxaLevel:()=>Zn,TaxaLevelLabel:()=>Qn,TaxonomyDB:()=>tr,TaxonomyDisplayType:()=>er,TaxonomyRank:()=>nr,TopLevelRank:()=>rr,VisualBrowser:()=>fr,WebServiceKey:()=>ir,WebStorageKey:()=>ar});const n=new class{applicationURL=null;baseWebServiceURL=null;currentMslRelease=null;currentVMR=null;drupalWebServiceURL=null;releaseProposalsURL=null;taxonHistoryPage=null;webServiceLookup={createCuratedName:"create-curated-name",deleteCuratedName:"delete-curated-name",getCuratedName:"get-curated-name",getCuratedNames:"get-curated-names",updateCuratedName:"update-curated-name",csrfToken:"session/token",proposal:"proposal-api",getSequenceSearchResult:"get-seqsearch-result",uploadSequences:"upload-sequences",taxonomy:"taxonomy.ashx",getMslRelease:"get-msl-release",getByReleasePreExpanded:"get-by-release-pre-expanded",getChildTaxa:"get-child-taxa",searchTaxonomy:"search-taxonomy",getTreeExpandedToNode:"get-tree-expanded-to-node",getTaxaByName:"get-taxa-by-name",getTaxonDetails:"get-taxon-details",getUnassignedChildTaxaByName:"get-unassigned-child-taxa-by-name",getReleaseHistory:"get-release-history",getReleaseTaxa:"get-release-taxa",taxonomyHistory:"taxonomyHistory.ashx",getTaxonHistory:"get-taxon-history",virusIsolate:"get-virus-isolates",virusNameLookup:"virus-name-lookup"}};function r(){}function i(t){return null==t?r:function(){return this.querySelector(t)}}function a(){return[]}function o(t){return null==t?a:function(){return this.querySelectorAll(t)}}function s(t){return function(){return this.matches(t)}}function u(t){return function(e){return e.matches(t)}}var l=Array.prototype.find;function c(){return this.firstElementChild}var h=Array.prototype.filter;function f(){return Array.from(this.children)}function d(t){return new Array(t.length)}function p(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function m(t,e,n,r,i,a){for(var o,s=0,u=e.length,l=a.length;s<l;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):n[s]=new p(t,a[s]);for(;s<u;++s)(o=e[s])&&(i[s]=o)}function g(t,e,n,r,i,a,o){var s,u,l,c=new Map,h=e.length,f=a.length,d=new Array(h);for(s=0;s<h;++s)(u=e[s])&&(d[s]=l=o.call(u,u.__data__,s,e)+"",c.has(l)?i[s]=u:c.set(l,u));for(s=0;s<f;++s)l=o.call(t,a[s],s,a)+"",(u=c.get(l))?(r[s]=u,u.__data__=a[s],c.delete(l)):n[s]=new p(t,a[s]);for(s=0;s<h;++s)(u=e[s])&&c.get(d[s])===u&&(i[s]=u)}function y(t){return t.__data__}function _(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function v(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}p.prototype={constructor:p,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var w="http://www.w3.org/1999/xhtml";const b={svg:"http://www.w3.org/2000/svg",xhtml:w,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function x(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),b.hasOwnProperty(e)?{space:b[e],local:t}:t}function k(t){return function(){this.removeAttribute(t)}}function S(t){return function(){this.removeAttributeNS(t.space,t.local)}}function $(t,e){return function(){this.setAttribute(t,e)}}function N(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function A(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function T(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function M(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function E(t){return function(){this.style.removeProperty(t)}}function C(t,e,n){return function(){this.style.setProperty(t,e,n)}}function R(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function q(t,e){return t.style.getPropertyValue(e)||M(t).getComputedStyle(t,null).getPropertyValue(e)}function L(t){return function(){delete this[t]}}function I(t,e){return function(){this[t]=e}}function P(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function B(t){return t.trim().split(/^|\s+/)}function O(t){return t.classList||new D(t)}function D(t){this._node=t,this._names=B(t.getAttribute("class")||"")}function H(t,e){for(var n=O(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function V(t,e){for(var n=O(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function j(t){return function(){H(this,t)}}function X(t){return function(){V(this,t)}}function U(t,e){return function(){(e.apply(this,arguments)?H:V)(this,t)}}function W(){this.textContent=""}function z(t){return function(){this.textContent=t}}function Y(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function G(){this.innerHTML=""}function F(t){return function(){this.innerHTML=t}}function K(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function J(){this.nextSibling&&this.parentNode.appendChild(this)}function Z(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Q(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===w&&e.documentElement.namespaceURI===w?e.createElement(t):e.createElementNS(n,t)}}function tt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function et(t){var e=x(t);return(e.local?tt:Q)(e)}function nt(){return null}function rt(){var t=this.parentNode;t&&t.removeChild(this)}function it(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function at(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ot(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,a=e.length;r<a;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function st(t,e,n){return function(){var r,i=this.__on,a=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var o=0,s=i.length;o<s;++o)if((r=i[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=a,r.options=n),void(r.value=e);this.addEventListener(t.type,a,n),r={type:t.type,name:t.name,value:e,listener:a,options:n},i?i.push(r):this.__on=[r]}}function ut(t,e,n){var r=M(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function lt(t,e){return function(){return ut(this,t,e)}}function ct(t,e){return function(){return ut(this,t,e.apply(this,arguments))}}D.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var ht=[null];function ft(t,e){this._groups=t,this._parents=e}function dt(){return new ft([[document.documentElement]],ht)}ft.prototype=dt.prototype={constructor:ft,select:function(t){"function"!=typeof t&&(t=i(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o,s,u=e[a],l=u.length,c=r[a]=new Array(l),h=0;h<l;++h)(o=u[h])&&(s=t.call(o,o.__data__,h,u))&&("__data__"in o&&(s.__data__=o.__data__),c[h]=s);return new ft(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):o(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var s,u=e[a],l=u.length,c=0;c<l;++c)(s=u[c])&&(r.push(t.call(s,s.__data__,c,u)),i.push(s));return new ft(r,i)},selectChild:function(t){return this.select(null==t?c:function(t){return function(){return l.call(this.children,t)}}("function"==typeof t?t:u(t)))},selectChildren:function(t){return this.selectAll(null==t?f:function(t){return function(){return h.call(this.children,t)}}("function"==typeof t?t:u(t)))},filter:function(t){"function"!=typeof t&&(t=s(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a,o=e[i],u=o.length,l=r[i]=[],c=0;c<u;++c)(a=o[c])&&t.call(a,a.__data__,c,o)&&l.push(a);return new ft(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,y);var n,r=e?g:m,i=this._parents,a=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=a.length,s=new Array(o),u=new Array(o),l=new Array(o),c=0;c<o;++c){var h=i[c],f=a[c],d=f.length,p=_(t.call(h,h&&h.__data__,c,i)),v=p.length,w=u[c]=new Array(v),b=s[c]=new Array(v);r(h,f,w,b,l[c]=new Array(d),p,e);for(var x,k,S=0,$=0;S<v;++S)if(x=w[S]){for(S>=$&&($=S+1);!(k=b[$])&&++$<v;);x._next=k||null}}return(s=new ft(s,i))._enter=u,s._exit=l,s},enter:function(){return new ft(this._enter||this._groups.map(d),this._parents)},exit:function(){return new ft(this._exit||this._groups.map(d),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,a=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?a.remove():n(a),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,o=Math.min(i,a),s=new Array(i),u=0;u<o;++u)for(var l,c=n[u],h=r[u],f=c.length,d=s[u]=new Array(f),p=0;p<f;++p)(l=c[p]||h[p])&&(d[p]=l);for(;u<i;++u)s[u]=n[u];return new ft(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=v);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,s=n[a],u=s.length,l=i[a]=new Array(u),c=0;c<u;++c)(o=s[c])&&(l[c]=o);l.sort(e)}return new ft(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,a=e[n],o=0,s=a.length;o<s;++o)(i=a[o])&&t.call(i,i.__data__,o,a);return this},attr:function(t,e){var n=x(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?S:k:"function"==typeof e?n.local?T:A:n.local?N:$)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?E:"function"==typeof e?R:C)(t,e,null==n?"":n)):q(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?L:"function"==typeof e?P:I)(t,e)):this.node()[t]},classed:function(t,e){var n=B(t+"");if(arguments.length<2){for(var r=O(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?U:e?j:X)(n,e))},text:function(t){return arguments.length?this.each(null==t?W:("function"==typeof t?Y:z)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?G:("function"==typeof t?K:F)(t)):this.node().innerHTML},raise:function(){return this.each(J)},lower:function(){return this.each(Z)},append:function(t){var e="function"==typeof t?t:et(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:et(t),r=null==e?nt:"function"==typeof e?e:i(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(rt)},clone:function(t){return this.select(t?at:it)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,a=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),o=a.length;if(!(arguments.length<2)){for(s=e?st:ot,r=0;r<o;++r)this.each(s(a[r],e,n));return this}var s=this.node().__on;if(s)for(var u,l=0,c=s.length;l<c;++l)for(r=0,u=s[l];r<o;++r)if((i=a[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?ct:lt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],a=0,o=i.length;a<o;++a)(r=i[a])&&(yield r)}};const pt=dt;var mt={value:()=>{}};function gt(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new yt(r)}function yt(t){this._=t}function _t(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function vt(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=mt,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}yt.prototype=gt.prototype={constructor:yt,on:function(t,e){var n,r,i=this._,a=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),o=-1,s=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<s;)if(n=(t=a[o]).type)i[n]=vt(i[n],t.name,e);else if(null==e)for(n in i)i[n]=vt(i[n],t.name,null);return this}for(;++o<s;)if((n=(t=a[o]).type)&&(n=_t(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new yt(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(r=this._[t]).length;a<n;++a)r[a].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};const wt=gt;var bt,xt,kt=0,St=0,$t=0,Nt=0,At=0,Tt=0,Mt="object"==typeof performance&&performance.now?performance:Date,Et="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Ct(){return At||(Et(Rt),At=Mt.now()+Tt)}function Rt(){At=0}function qt(){this._call=this._time=this._next=null}function Lt(t,e,n){var r=new qt;return r.restart(t,e,n),r}function It(){At=(Nt=Mt.now())+Tt,kt=St=0;try{!function(){Ct(),++kt;for(var t,e=bt;e;)(t=At-e._time)>=0&&e._call.call(void 0,t),e=e._next;--kt}()}finally{kt=0,function(){for(var t,e,n=bt,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:bt=e);xt=t,Bt(r)}(),At=0}}function Pt(){var t=Mt.now(),e=t-Nt;e>1e3&&(Tt-=e,Nt=t)}function Bt(t){kt||(St&&(St=clearTimeout(St)),t-At>24?(t<1/0&&(St=setTimeout(It,t-Mt.now()-Tt)),$t&&($t=clearInterval($t))):($t||(Nt=Mt.now(),$t=setInterval(Pt,1e3)),kt=1,Et(It)))}function Ot(t,e,n){var r=new qt;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}qt.prototype=Lt.prototype={constructor:qt,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Ct():+n)+(null==e?0:+e),this._next||xt===this||(xt?xt._next=this:bt=this,xt=this),this._call=t,this._time=n,Bt()},stop:function(){this._call&&(this._call=null,this._time=1/0,Bt())}};var Dt=wt("start","end","cancel","interrupt"),Ht=[];function Vt(t,e,n,r,i,a){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function a(u){var l,c,h,f;if(1!==n.state)return s();for(l in i)if((f=i[l]).name===n.name){if(3===f.state)return Ot(a);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete i[l]):+l<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete i[l])}if(Ot((function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(u))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),l=0,c=-1;l<h;++l)(f=n.tween[l].value.call(t,t.__data__,n.index,n.group))&&(r[++c]=f);r.length=c+1}}function o(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),a=-1,o=r.length;++a<o;)r[a].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=Lt((function(t){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=t&&a(t-n.delay)}),0,n.time)}(t,n,{name:e,index:r,group:i,on:Dt,tween:Ht,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function jt(t,e){var n=Ut(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Xt(t,e){var n=Ut(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Ut(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Wt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var zt,Yt=180/Math.PI,Gt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ft(t,e,n,r,i,a){var o,s,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*Yt,skewX:Math.atan(u)*Yt,scaleX:o,scaleY:s}}function Kt(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(a,o){var s=[],u=[];return a=t(a),o=t(o),function(t,r,i,a,o,s){if(t!==i||r!==a){var u=o.push("translate(",null,e,null,n);s.push({i:u-4,x:Wt(t,i)},{i:u-2,x:Wt(r,a)})}else(i||a)&&o.push("translate("+i+e+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,u),function(t,e,n,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Wt(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(a.rotate,o.rotate,s,u),function(t,e,n,a){t!==e?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Wt(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(a.skewX,o.skewX,s,u),function(t,e,n,r,a,o){if(t!==n||e!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:Wt(t,n)},{i:s-2,x:Wt(e,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,u),a=o=null,function(t){for(var e,n=-1,r=u.length;++n<r;)s[(e=u[n]).i]=e.x(t);return s.join("")}}}var Jt=Kt((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Gt:Ft(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),Zt=Kt((function(t){return null==t?Gt:(zt||(zt=document.createElementNS("http://www.w3.org/2000/svg","g")),zt.setAttribute("transform",t),(t=zt.transform.baseVal.consolidate())?Ft((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Gt)}),", ",")",")");function Qt(t,e){var n,r;return function(){var i=Xt(this,t),a=i.tween;if(a!==n)for(var o=0,s=(r=n=a).length;o<s;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}i.tween=r}}function te(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var a=Xt(this,t),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:e,value:n},u=0,l=i.length;u<l;++u)if(i[u].name===e){i[u]=s;break}u===l&&i.push(s)}a.tween=i}}function ee(t,e,n){var r=t._id;return t.each((function(){var t=Xt(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Ut(t,r).value[e]}}function ne(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function re(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ie(){}var ae=.7,oe=1/ae,se="\\s*([+-]?\\d+)\\s*",ue="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",le="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ce=/^#([0-9a-f]{3,8})$/,he=new RegExp(`^rgb\\(${se},${se},${se}\\)$`),fe=new RegExp(`^rgb\\(${le},${le},${le}\\)$`),de=new RegExp(`^rgba\\(${se},${se},${se},${ue}\\)$`),pe=new RegExp(`^rgba\\(${le},${le},${le},${ue}\\)$`),me=new RegExp(`^hsl\\(${ue},${le},${le}\\)$`),ge=new RegExp(`^hsla\\(${ue},${le},${le},${ue}\\)$`),ye={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function _e(){return this.rgb().formatHex()}function ve(){return this.rgb().formatRgb()}function we(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ce.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?be(e):3===n?new Se(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?xe(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?xe(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=he.exec(t))?new Se(e[1],e[2],e[3],1):(e=fe.exec(t))?new Se(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=de.exec(t))?xe(e[1],e[2],e[3],e[4]):(e=pe.exec(t))?xe(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=me.exec(t))?Ee(e[1],e[2]/100,e[3]/100,1):(e=ge.exec(t))?Ee(e[1],e[2]/100,e[3]/100,e[4]):ye.hasOwnProperty(t)?be(ye[t]):"transparent"===t?new Se(NaN,NaN,NaN,0):null}function be(t){return new Se(t>>16&255,t>>8&255,255&t,1)}function xe(t,e,n,r){return r<=0&&(t=e=n=NaN),new Se(t,e,n,r)}function ke(t,e,n,r){return 1===arguments.length?((i=t)instanceof ie||(i=we(i)),i?new Se((i=i.rgb()).r,i.g,i.b,i.opacity):new Se):new Se(t,e,n,null==r?1:r);var i}function Se(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function $e(){return`#${Me(this.r)}${Me(this.g)}${Me(this.b)}`}function Ne(){const t=Ae(this.opacity);return`${1===t?"rgb(":"rgba("}${Te(this.r)}, ${Te(this.g)}, ${Te(this.b)}${1===t?")":`, ${t})`}`}function Ae(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Te(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Me(t){return((t=Te(t))<16?"0":"")+t.toString(16)}function Ee(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Re(t,e,n,r)}function Ce(t){if(t instanceof Re)return new Re(t.h,t.s,t.l,t.opacity);if(t instanceof ie||(t=we(t)),!t)return new Re;if(t instanceof Re)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=e===a?(n-r)/s+6*(n<r):n===a?(r-e)/s+2:(e-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new Re(o,s,u,t.opacity)}function Re(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function qe(t){return(t=(t||0)%360)<0?t+360:t}function Le(t){return Math.max(0,Math.min(1,t||0))}function Ie(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Pe(t,e,n,r,i){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*r+o*i)/6}ne(ie,we,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:_e,formatHex:_e,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Ce(this).formatHsl()},formatRgb:ve,toString:ve}),ne(Se,ke,re(ie,{brighter(t){return t=null==t?oe:Math.pow(oe,t),new Se(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?ae:Math.pow(ae,t),new Se(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Se(Te(this.r),Te(this.g),Te(this.b),Ae(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$e,formatHex:$e,formatHex8:function(){return`#${Me(this.r)}${Me(this.g)}${Me(this.b)}${Me(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Ne,toString:Ne})),ne(Re,(function(t,e,n,r){return 1===arguments.length?Ce(t):new Re(t,e,n,null==r?1:r)}),re(ie,{brighter(t){return t=null==t?oe:Math.pow(oe,t),new Re(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?ae:Math.pow(ae,t),new Re(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Se(Ie(t>=240?t-240:t+120,i,r),Ie(t,i,r),Ie(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Re(qe(this.h),Le(this.s),Le(this.l),Ae(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ae(this.opacity);return`${1===t?"hsl(":"hsla("}${qe(this.h)}, ${100*Le(this.s)}%, ${100*Le(this.l)}%${1===t?")":`, ${t})`}`}}));const Be=t=>()=>t;function Oe(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):Be(isNaN(t)?e:t)}const De=function t(e){var n=function(t){return 1==(t=+t)?Oe:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Be(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=ke(t)).r,(e=ke(e)).r),i=n(t.g,e.g),a=n(t.b,e.b),o=Oe(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=a(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function He(t){return function(e){var n,r,i=e.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=ke(e[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=t(a),o=t(o),s=t(s),r.opacity=1,function(t){return r.r=a(t),r.g=o(t),r.b=s(t),r+""}}}He((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],a=t[r+1],o=r>0?t[r-1]:2*i-a,s=r<e-1?t[r+2]:2*a-i;return Pe((n-r/e)*e,o,i,a,s)}})),He((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],a=t[r%e],o=t[(r+1)%e],s=t[(r+2)%e];return Pe((n-r/e)*e,i,a,o,s)}}));var Ve=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,je=new RegExp(Ve.source,"g");function Xe(t,e){var n,r,i,a=Ve.lastIndex=je.lastIndex=0,o=-1,s=[],u=[];for(t+="",e+="";(n=Ve.exec(t))&&(r=je.exec(e));)(i=r.index)>a&&(i=e.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,u.push({i:o,x:Wt(n,r)})),a=je.lastIndex;return a<e.length&&(i=e.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function Ue(t,e){var n;return("number"==typeof e?Wt:e instanceof we?De:(n=we(e))?(e=n,De):Xe)(t,e)}function We(t){return function(){this.removeAttribute(t)}}function ze(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ye(t,e,n){var r,i,a=n+"";return function(){var o=this.getAttribute(t);return o===a?null:o===r?i:i=e(r=o,n)}}function Ge(t,e,n){var r,i,a=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===a?null:o===r?i:i=e(r=o,n)}}function Fe(t,e,n){var r,i,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttribute(t))===(s=u+"")?null:o===r&&s===i?a:(i=s,a=e(r=o,u));this.removeAttribute(t)}}function Ke(t,e,n){var r,i,a;return function(){var o,s,u=n(this);if(null!=u)return(o=this.getAttributeNS(t.space,t.local))===(s=u+"")?null:o===r&&s===i?a:(i=s,a=e(r=o,u));this.removeAttributeNS(t.space,t.local)}}function Je(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,i)),n}return i._value=e,i}function Ze(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,i)),n}return i._value=e,i}function Qe(t,e){return function(){jt(this,t).delay=+e.apply(this,arguments)}}function tn(t,e){return e=+e,function(){jt(this,t).delay=e}}function en(t,e){return function(){Xt(this,t).duration=+e.apply(this,arguments)}}function nn(t,e){return e=+e,function(){Xt(this,t).duration=e}}var rn=pt.prototype.constructor;function an(t){return function(){this.style.removeProperty(t)}}var on=0;function sn(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function un(){return++on}var ln=pt.prototype;sn.prototype=function(t){return pt().transition(t)}.prototype={constructor:sn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=i(t));for(var r=this._groups,a=r.length,o=new Array(a),s=0;s<a;++s)for(var u,l,c=r[s],h=c.length,f=o[s]=new Array(h),d=0;d<h;++d)(u=c[d])&&(l=t.call(u,u.__data__,d,c))&&("__data__"in u&&(l.__data__=u.__data__),f[d]=l,Vt(f[d],e,n,d,f,Ut(u,n)));return new sn(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=o(t));for(var r=this._groups,i=r.length,a=[],s=[],u=0;u<i;++u)for(var l,c=r[u],h=c.length,f=0;f<h;++f)if(l=c[f]){for(var d,p=t.call(l,l.__data__,f,c),m=Ut(l,n),g=0,y=p.length;g<y;++g)(d=p[g])&&Vt(d,e,n,g,p,m);a.push(p),s.push(l)}return new sn(a,s,e,n)},selectChild:ln.selectChild,selectChildren:ln.selectChildren,filter:function(t){"function"!=typeof t&&(t=s(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a,o=e[i],u=o.length,l=r[i]=[],c=0;c<u;++c)(a=o[c])&&t.call(a,a.__data__,c,o)&&l.push(a);return new sn(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var u,l=e[s],c=n[s],h=l.length,f=o[s]=new Array(h),d=0;d<h;++d)(u=l[d]||c[d])&&(f[d]=u);for(;s<r;++s)o[s]=e[s];return new sn(o,this._parents,this._name,this._id)},selection:function(){return new rn(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=un(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o,s=r[a],u=s.length,l=0;l<u;++l)if(o=s[l]){var c=Ut(o,e);Vt(o,t,n,l,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new sn(r,this._parents,t,n)},call:ln.call,nodes:ln.nodes,node:ln.node,size:ln.size,empty:ln.empty,each:ln.each,on:function(t,e){var n=this._id;return arguments.length<2?Ut(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,a=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?jt:Xt;return function(){var o=a(this,t),s=o.on;s!==r&&(i=(r=s).copy()).on(e,n),o.on=i}}(n,t,e))},attr:function(t,e){var n=x(t),r="transform"===n?Zt:Ue;return this.attrTween(t,"function"==typeof e?(n.local?Ke:Fe)(n,r,ee(this,"attr."+t,e)):null==e?(n.local?ze:We)(n):(n.local?Ge:Ye)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=x(t);return this.tween(n,(r.local?Je:Ze)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?Jt:Ue;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var a=q(this,t),o=(this.style.removeProperty(t),q(this,t));return a===o?null:a===n&&o===r?i:i=e(n=a,r=o)}}(t,r)).on("end.style."+t,an(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,a;return function(){var o=q(this,t),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(t),u=s=q(this,t)),o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,s))}}(t,r,ee(this,"style."+t,e))).each(function(t,e){var n,r,i,a,o="style."+e,s="end."+o;return function(){var u=Xt(this,t),l=u.on,c=null==u.value[o]?a||(a=an(e)):void 0;l===n&&i===c||(r=(n=l).copy()).on(s,i=c),u.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,a=n+"";return function(){var o=q(this,t);return o===a?null:o===r?i:i=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,i;function a(){var a=e.apply(this,arguments);return a!==i&&(r=(i=a)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,a,n)),r}return a._value=e,a}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(ee(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=Ut(this.node(),n).tween,a=0,o=i.length;a<o;++a)if((r=i[a]).name===t)return r.value;return null}return this.each((null==e?Qt:te)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Qe:tn)(e,t)):Ut(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?en:nn)(e,t)):Ut(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Xt(this,t).ease=e}}(e,t)):Ut(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Xt(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise((function(a,o){var s={value:o},u={value:function(){0==--i&&a()}};n.each((function(){var n=Xt(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(u)),n.on=e})),0===i&&a()}))},[Symbol.iterator]:ln[Symbol.iterator]};var cn={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function hn(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}pt.prototype.interrupt=function(t){return this.each((function(){!function(t,e){var n,r,i,a=t.__transition,o=!0;if(a){for(i in e=null==e?null:e+"",a)(n=a[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete a[i]):o=!1;o&&delete t.__transition}}(this,t)}))},pt.prototype.transition=function(t){var e,n;t instanceof sn?(e=t._id,t=t._name):(e=un(),(n=cn).time=Ct(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o,s=r[a],u=s.length,l=0;l<u;++l)(o=s[l])&&Vt(o,t,e,l,s,n||hn(o,e));return new sn(r,this._parents,t,e)};const{abs:fn,max:dn,min:pn}=Math;function mn(t){return{type:t}}function gn(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function yn(t,e){return fetch(t,e).then(gn)}function _n(t,e){return t.parent===e.parent?1:2}function vn(t,e){return t+e.x}function wn(t,e){return Math.max(t,e.y)}function bn(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function xn(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=Sn)):void 0===e&&(e=kn);for(var n,r,i,a,o,s=new An(t),u=[s];n=u.pop();)if((i=e(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)u.push(r=i[a]=new An(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(Nn)}function kn(t){return t.children}function Sn(t){return Array.isArray(t)?t[1]:null}function $n(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function Nn(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function An(t){this.data=t,this.depth=this.height=0,this.parent=null}["w","e"].map(mn),["n","s"].map(mn),["n","w","e","s","nw","ne","sw","se"].map(mn),An.prototype=xn.prototype={constructor:An,count:function(){return this.eachAfter(bn)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,i,a=this,o=[a],s=[],u=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)t.call(e,a,++u,this);return this},eachBefore:function(t,e){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(t.call(e,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return xn(this).eachBefore($n)},[Symbol.iterator]:function*(){var t,e,n,r,i=this,a=[i];do{for(t=a.reverse(),a=[];i=t.pop();)if(yield i,e=i.children)for(n=0,r=e.length;n<r;++n)a.push(e[n])}while(a.length)}};var Tn=Array.prototype.slice;function Mn(t){return function(){return t}}class En{constructor(t,e){this._context=t,this._x=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,e,t,e):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+e)/2,t,this._y0,t,e)}this._x0=t,this._y0=e}}function Cn(t){return new En(t,!0)}const Rn=Math.PI,qn=2*Rn,Ln=1e-6,In=qn-Ln;function Pn(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}class Bn{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?Pn:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return Pn;const n=10**e;return function(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,n,r){this._append`Q${+t},${+e},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(t,e,n,r,i,a){this._append`C${+t},${+e},${+n},${+r},${this._x1=+i},${this._y1=+a}`}arcTo(t,e,n,r,i){if(t=+t,e=+e,n=+n,r=+r,(i=+i)<0)throw new Error(`negative radius: ${i}`);let a=this._x1,o=this._y1,s=n-t,u=r-e,l=a-t,c=o-e,h=l*l+c*c;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(h>Ln)if(Math.abs(c*s-u*l)>Ln&&i){let f=n-a,d=r-o,p=s*s+u*u,m=f*f+d*d,g=Math.sqrt(p),y=Math.sqrt(h),_=i*Math.tan((Rn-Math.acos((p+h-m)/(2*g*y)))/2),v=_/y,w=_/g;Math.abs(v-1)>Ln&&this._append`L${t+v*l},${e+v*c}`,this._append`A${i},${i},0,0,${+(c*f>l*d)},${this._x1=t+w*s},${this._y1=e+w*u}`}else this._append`L${this._x1=t},${this._y1=e}`}arc(t,e,n,r,i,a){if(t=+t,e=+e,a=!!a,(n=+n)<0)throw new Error(`negative radius: ${n}`);let o=n*Math.cos(r),s=n*Math.sin(r),u=t+o,l=e+s,c=1^a,h=a?r-i:i-r;null===this._x1?this._append`M${u},${l}`:(Math.abs(this._x1-u)>Ln||Math.abs(this._y1-l)>Ln)&&this._append`L${u},${l}`,n&&(h<0&&(h=h%qn+qn),h>In?this._append`A${n},${n},0,1,${c},${t-o},${e-s}A${n},${n},0,1,${c},${this._x1=u},${this._y1=l}`:h>Ln&&this._append`A${n},${n},0,${+(h>=Rn)},${c},${this._x1=t+n*Math.cos(i)},${this._y1=e+n*Math.sin(i)}`)}rect(t,e,n,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function On(t){return t[0]}function Dn(t){return t[1]}function Hn(t){return t.source}function Vn(t){return t.target}function jn(t,e,n){this.k=t,this.x=e,this.y=n}var Xn,Un,Wn,zn,Yn,Gn,Fn,Kn,Jn,Zn,Qn,tr,er,nr,rr,ir,ar;function or(t){switch(t){case Un.ictv:case Un.ictv_id:return zn.ICTV;case Un.id:return zn.none;case Un.msl:case Un.msl_id:return zn.MSL;case Un.taxnode_id:case Un.tn:case Un.tn_id:return zn.taxonomy;case Un.vmr:case Un.vmr_id:return zn.VMR;default:return zn.none}}function sr(t,e){if(e!==tr.ictv_vmr)return t.replace("_"," ");switch(t){case Gn.genbank_accession:return"virus GenBank accession";case Gn.isolate_abbreviation:return"virus name abbreviation";case Gn.isolate_designation:return"virus isolate designation";case Gn.isolate_name:return"virus name";case Gn.refseq_accession:return"virus RefSeq accession";default:return t.replace("_"," ")}}function ur(t,e){if(e===tr.ictv_vmr)switch(t){case Gn.genbank_accession:return"The GenBank (nucleotide) accession number(s) for the exemplar (or additional) virus isolate of the indicated species";case Gn.isolate_abbreviation:return"Commonly used abbreviation(s) of the virus name(s)";case Gn.isolate_designation:return"The designation of the virus isolate (often also referred to as variants or strains)";case Gn.isolate_name:return"Commonly used virus name or names";case Gn.refseq_accession:return"The equivalent RefSeq accession numbers for the GenBank (nucleotide) accession number(s)";default:return t.replace("_"," ")}else switch(t){case Gn.abbreviation:return"An abbreviation associated with the virus";case Gn.acronym:return"An acronym associated with the virus";case Gn.authority:return"The name of the scientist(s) who originally described the virus and the year it was published";case Gn.blast_name:return"A simplified name used by BLAST (Basic Local Alignment Search Tool) for grouping organisms into broad categories";case Gn.common_name:return"An informal name in common usage";case Gn.disease:return"A disease caused by a virus";case Gn.equivalent_name:return"A name that is considered equivalent to the scientific name but may not be currently used";case Gn.genbank_accession:return"A unique alphanumeric identifier assigned to a specific sequence record in the GenBank database";case Gn.genbank_acronym:return"An acronym used in GenBank records";case Gn.genbank_common_name:return"The common name associated with the virus used specifically in GenBank records";case Gn.includes:return"A name that encompasses subgroups or other taxa included within the current taxon";case Gn.in_part:return"A name that is only partially synonymous with the virus";case Gn.isolate_abbreviation:return"A shortened or abbreviated form of a specific isolate's name";case Gn.isolate_designation:return"A specific identifier or label given to a particular isolate, often used to differentiate among multiple isolates of the same species";case Gn.isolate_exemplar:return"A representative isolate chosen as the best example or reference for a specific group, strain, or species";case Gn.isolate_name:return"The full or descriptive name assigned to an isolate, often reflecting its source, collection location, or other unique characteristics";case Gn.refseq_accession:return"A unique alphanumeric identifier assigned to a specific sequence record in the NCBI RefSeq (Reference Sequence) database";case Gn.refseq_organism:return"The organism name associated with a specific RefSeq entry. It refers to the taxonomic identity of the organism for which a curated reference sequence is provided in the RefSeq database";case Gn.scientific_name:return"Name derived from NCBI lineage";case Gn.synonym:return"Alternative scientific names that have been historically used for a virus or taxon but are not the currently accepted name";case Gn.taxon_name:return"A formal taxonomic name";case Gn.type_material:return"A name related to the type specimen or type material upon which the taxon's description is based"}}function lr(t){switch(t){case Kn.abolished:return"abolished";case Kn.current:return"current";case Kn.demoted:return"demoted";case Kn.lineageUpdated:return"lineage updated";case Kn.merged:return"merged";case Kn.moved:return"moved";case Kn.new:return"new";case Kn.promoted:return"promoted";case Kn.renamed:return"renamed";case Kn.split:return"split";case Kn.unchanged:return"unchanged";default:return t}}function cr(t){switch(t){case Kn.abolished:return"The taxon is abolished (deleted) from the MSL. All constituent taxa need to be moved, otherwise they will also be deleted.";case Kn.current:return"TODO";case Kn.demoted:return"A higher rank taxon is moved to a lower rank (potentially requiring a rename). This does NOT necessarily imply that the constituent members of the promoted taxon are subject to any change.";case Kn.lineageUpdated:return"TODO";case Kn.merged:return"Two separate taxa will be merged into a single taxon. The single taxon may be one of the initial two, or it could be a newly created taxon. All constituent, lower rank members will be automatically moved into the merged taxon.";case Kn.moved:return"A lower rank taxon and its constituent members is moved from one higher rank taxon to another. (The move usually, but not necessarily, is to a taxon (existing or new) at the same rank as the original parent.)";case Kn.new:return"Creation of a new taxon. New ranks higher than Species must contain new (or moved) lower-rank members.";case Kn.promoted:return"A lower rank taxon is moved to a higher rank (usually also requiring a rename). This does NOT necessarily imply that the constituent members of the promoted taxon are subject to any change.";case Kn.renamed:return"A taxon is renamed. The new name must adhere to the naming rules of the ICTV Code of Virus Classification and Nomenclature.";case Kn.split:return"A taxon, along with its constituent members, are split into two or more taxa. The original taxon that was split may, or may not, be retained, and the resulting set of taxa into which the original was split, may consist of existing or new taxa. The change must be accompanied with an indication of where each of the constituent member taxa are to be moved. Theoretically, this action could be accomplished with a combination of changes involving Moved, Abolished, and New, but was created to maintain the history of all changes to the original taxon and its members.";case Kn.unchanged:return"The taxon is unchanged. This is used to indicate that the taxon is not subject to any change in the current release.";default:return t}}function hr(t){return nr[t]}jn.prototype={constructor:jn,scale:function(t){return 1===t?this:new jn(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new jn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new jn(1,0,0),jn.prototype,function(t){t.disease="disease",t.other="other"}(Xn||(Xn={})),function(t){t.taxnode_id="taxnode_id",t.tn="tn",t.tn_id="tn_id",t.ictv="ictv",t.ictv_id="ictv_id",t.id="id",t.vmr="vmr",t.vmr_id="vmr_id",t.msl="msl",t.msl_id="msl_id"}(Un||(Un={})),function(t){t.ICTV="ICTV",t.MSL="MSL",t.none="none",t.taxonomy="TN",t.VMR="VMR"}(Wn||(Wn={})),function(t){t.ICTV="ICTV",t.MSL="MSL",t.none="none",t.taxonomy="taxonomy",t.VMR="VMR"}(zn||(zn={})),function(t){t.complete="complete",t.crashed="crashed",t.error="error",t.invalid="invalid",t.pending="pending",t.valid="valid"}(Yn||(Yn={})),function(t){t.abbreviation="abbreviation",t.acronym="acronym",t.authority="authority",t.blast_name="blast_name",t.common_name="common_name",t.disease="disease",t.equivalent_name="equivalent_name",t.genbank_accession="genbank_accession",t.genbank_acronym="genbank_acronym",t.genbank_common_name="genbank_common_name",t.includes="includes",t.in_part="in_part",t.isolate_abbreviation="isolate_abbreviation",t.isolate_designation="isolate_designation",t.isolate_exemplar="isolate_exemplar",t.isolate_name="isolate_name",t.refseq_accession="refseq_accession",t.refseq_organism="refseq_organism",t.scientific_name="scientific_name",t.synonym="synonym",t.taxon_name="taxon_name",t.type_material="type_material"}(Gn||(Gn={})),function(t){t[t.tree=0]="tree",t[t.realm=1]="realm",t[t.subrealm=2]="subrealm",t[t.kingdom=3]="kingdom",t[t.subkingdom=4]="subkingdom",t[t.phylum=5]="phylum",t[t.subphylum=6]="subphylum",t[t.class=7]="class",t[t.subclass=8]="subclass",t[t.order=9]="order",t[t.suborder=10]="suborder",t[t.family=11]="family",t[t.subfamily=12]="subfamily",t[t.genus=13]="genus",t[t.subgenus=14]="subgenus",t[t.species=15]="species"}(Fn||(Fn={})),function(t){t.abolished="abolished",t.current="current",t.demoted="demoted",t.lineageUpdated="lineage_updated",t.merged="merged",t.moved="moved",t.new="new",t.promoted="promoted",t.renamed="renamed",t.split="split",t.unchanged="unchanged"}(Kn||(Kn={})),function(t){t.all_words="all_words",t.any_words="any_words",t.contains="contains",t.exact_match="exact_match"}(Jn||(Jn={})),function(t){t.tree="tree",t.realm="realm",t.subrealm="subrealm",t.kingdom="kingdom",t.subkingdom="subkingdom",t.phylum="phylum",t.subphylum="subphylum",t.class="class",t.subclass="subclass",t.order="order",t.suborder="suborder",t.family="family",t.subfamily="subfamily",t.genus="genus",t.subgenus="subgenus",t.species="species"}(Zn||(Zn={})),function(t){t.tree="Tree",t.realm="Realm",t.subrealm="Subrealm",t.kingdom="Kingdom",t.subkingdom="Subkingdom",t.phylum="Phylum",t.subphylum="Subphylum",t.class="Class",t.subclass="Subclass",t.order="Order",t.suborder="Suborder",t.family="Family",t.subfamily="Subfamily",t.genus="Genus",t.subgenus="Subgenus",t.species="Species"}(Qn||(Qn={})),function(t){t.disease_ontology="disease_ontology",t.ictv_curation="ictv_curation",t.ictv_epithets="ictv_epithets",t.ictv_taxonomy="ictv_taxonomy",t.ictv_vmr="ictv_vmr",t.ncbi_taxonomy="ncbi_taxonomy"}(tr||(tr={})),function(t){t.default_to_page="default_to_page",t.display_all="display_all",t.display_release_history="display_release_history",t.display_unassigned_child_taxa="display_unassigned_child_taxa",t.user_entered="user_entered"}(er||(er={})),function(t){t.biotype="Biotype",t.clade="Clade",t.class="Class",t.cohort="Cohort",t.family="Family",t.forma="Forma",t.forma_specialis="Forma Specialis",t.genotype="Genotype",t.genus="Genus",t.infraclass="Infraclass",t.infraorder="Infraorder",t.isolate="Isolate",t.kingdom="Kingdom",t.morph="Morph",t.no_rank="No rank",t.order="Order",t.parvorder="Parvorder",t.pathogroup="Pathogroup",t.phylum="Phylum",t.realm="Realm",t.section="Section",t.series="Series",t.serogroup="Serogroup",t.serotype="Serotype",t.species="Species",t.species_group="Species group",t.species_subgroup="Species subgroup",t.strain="Strain",t.subclass="Subclass",t.subcohort="Subcohort",t.subfamily="Subfamily",t.subgenus="Subgenus",t.subkingdom="Subkingdom",t.suborder="Suborder",t.subphylum="Subphylum",t.subrealm="Subrealm",t.subsection="Subsection",t.subspecies="Subspecies",t.subtribe="Subtribe",t.superclass="Superclass",t.superfamily="Superfamily",t.superkingdom="Superkingdom",t.superorder="Superorder",t.superphylum="Superphylum",t.tribe="Tribe",t.varietas="Varietas"}(nr||(nr={})),function(t){t.realm="realm",t.subrealm="subrealm",t.kingdom="kingdom",t.subkingdom="subkingdom",t.phylum="phylum",t.subphylum="subphylum",t.class="class",t.subclass="subclass",t.order="order",t.suborder="suborder",t.family="family",t.subfamily="subfamily",t.genus="genus",t.subgenus="subgenus",t.species="species"}(rr||(rr={})),function(t){t.createCuratedName="createCuratedName",t.deleteCuratedName="deleteCuratedName",t.getCuratedName="getCuratedName",t.getCuratedNames="getCuratedNames",t.updateCuratedName="updateCuratedName",t.csrfToken="csrfToken",t.proposal="proposal",t.getSequenceSearchResult="getSequenceSearchResult",t.uploadSequences="uploadSequences",t.taxonomy="taxonomy",t.getMslRelease="getMslRelease",t.getByReleasePreExpanded="getByReleasePreExpanded",t.getChildTaxa="getChildTaxa",t.searchTaxonomy="searchTaxonomy",t.getTreeExpandedToNode="getTreeExpandedToNode",t.getTaxaByName="getTaxaByName",t.getTaxonDetails="getTaxonDetails",t.getUnassignedChildTaxaByName="getUnassignedChildTaxaByName",t.getReleaseHistory="getReleaseHistory",t.getReleaseTaxa="getReleaseTaxa",t.taxonomyHistory="taxonomyHistory",t.getTaxonHistory="getTaxonHistory",t.virusIsolate="virusIsolate",t.virusNameLookup="virusNameLookup"}(ir||(ir={})),function(t){t.lineageExportSettings="lineage_export_settings",t.sequenceSearchUserUID="sequence_search_user_uid"}(ar||(ar={}));class fr{config={animation:{delay:1100,fast:250,slow:2500},node:{columnWidth:NaN,defaultColumnWidth:200,defaultVerticalDistance:20,verticalDistance:NaN},svg:{margin:{top:40,right:0,bottom:40,left:40},width:1e3},url:{data:null,taxonDetailsPage:null,taxonomy:null},zoom:{scaleFactor:.19,translateX:0,translateY:0}};containerSelector=null;currentRelease=null;data;diagonal;elements;gLegend;gLink;gNode;releases=null;root;selectedRelease=null;svg;tree;constructor(t,e){if(!t)throw new Error("Invalid container selector parameter");if(this.containerSelector=t,!e)throw new Error("Invalid data URL parameter");if(this.config.url.data=e,this.config.url.taxonDetailsPage=n.taxonHistoryPage,!this.config.url.taxonDetailsPage)throw new Error("Invalid taxon details app setting");const r=n.webServiceLookup[ir.taxonomy];this.config.url.taxonomy=`${n.baseWebServiceURL}${r}`,this.elements={container:null,svg:null},this.diagonal=function(t){let e=Hn,n=Vn,r=On,i=Dn,a=null,o=null,s=function(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);e=t}return t},()=>new Bn(e)}(u);function u(){let u;const l=Tn.call(arguments),c=e.apply(this,l),h=n.apply(this,l);if(null==a&&(o=t(u=s())),o.lineStart(),l[0]=c,o.point(+r.apply(this,l),+i.apply(this,l)),l[0]=h,o.point(+r.apply(this,l),+i.apply(this,l)),o.lineEnd(),u)return o=null,u+""||null}return u.source=function(t){return arguments.length?(e=t,u):e},u.target=function(t){return arguments.length?(n=t,u):n},u.x=function(t){return arguments.length?(r="function"==typeof t?t:Mn(+t),u):r},u.y=function(t){return arguments.length?(i="function"==typeof t?t:Mn(+t),u):i},u.context=function(e){return arguments.length?(null==e?a=o=null:o=t(a=e),u):a},u}(Cn).x((t=>t[1])).y((t=>t[0])),this.config.node.columnWidth=this.config.node.defaultColumnWidth,this.config.node.verticalDistance=this.config.node.defaultVerticalDistance}async displayTaxonomy(t){if(!t)throw new Error("Invalid release year in displayTaxonomy");if(this.selectedRelease=this.getRelease(t),!this.selectedRelease)throw new Error(`No data available for release year ${t}`);this.svg&&this.svg.node()&&this.svg.node().remove();const e=`${this.config.url.data}/taxonomy_${t}.json`;if(this.data=await yn(e),!this.data)throw new Error(`Invalid data for release year ${t}`);this.root=xn(this.data);const n=this.config.node.verticalDistance,r=this.config.svg.width/(this.root.height+1);this.tree=function(){var t=_n,e=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(e){var n=e.children;n?(e.x=function(t){return t.reduce(vn,0)/t.length}(n),e.y=function(t){return 1+t.reduce(wn,0)}(n)):(e.x=a?o+=t(e,a):0,e.y=0,a=e)}));var s=function(t){for(var e;e=t.children;)t=e[0];return t}(i),u=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(i),l=s.x-t(s,u)/2,c=u.x+t(u,s)/2;return i.eachAfter(r?function(t){t.x=(t.x-i.x)*e,t.y=(i.y-t.y)*n}:function(t){t.x=(t.x-l)/(c-l)*e,t.y=(1-(i.y?t.y/i.y:1))*n})}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i}().nodeSize([n,r]),this.root.sort(((t,e)=>function(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}(t.data.name,e.data.name))),this.tree(this.root);let i=1/0,a=-i;this.root.each((t=>{t.x>a&&(a=t.x),t.x<i&&(i=t.x)}));const o=a-i+2*n;var s;this.svg=(s="svg",function(t){return"string"==typeof t?new ft([[document.querySelector(t)]],[document.documentElement]):new ft([[t]],ht)}(et(s).call(document.documentElement))).attr("width",this.config.svg.width).attr("height",o).attr("viewBox",[-r/3,i-n,this.config.svg.width,o]),this.gLink=this.svg.append("g").attr("class","link-parent"),this.gNode=this.svg.append("g").attr("class","node-parent"),this.gLegend=this.svg.append("g").attr("class","legend-parent"),this.selectedRelease.ranks.forEach(((t,e)=>{this.gLegend.append("text").attr("class","legend-text").attr("x",this.config.node.columnWidth*e+"px").text(t)})),this.root.x0=r/2,this.root.y0=0,this.root.descendants().forEach(((t,e)=>{t.id=e,t._children=t.children,t.depth>0&&(t.children=null)})),this.update(null,this.root),this.elements.container.appendChild(this.svg.node())}getRelease(t){if(!t)throw new Error("Invalid release year in getRelease (empty)");const e=this.releases.data[`${t}`];if(!e)throw new Error(`No release found for release year ${t}`);return e}async initialize(){if(this.elements.container=document.querySelector(this.containerSelector),!this.elements.container)throw new Error("Invalid container element");if(this.releases=await yn(`${this.config.url.data}/releases.json`),!this.releases)throw new Error("Invalid releases JSON");const t=this.releases.displayOrder[0];if(!t)throw new Error("Invalid current year in releases.json");if(this.currentRelease=this.getRelease(t),!this.currentRelease)throw new Error("Invalid current release metadata");await this.displayTaxonomy(t)}update(t,e){const n=t?.altKey?this.config.animation.slow:this.config.animation.fast,r=this.root.descendants().reverse(),i=this.root.links();this.tree(this.root);let a=this.root,o=this.root;this.root.eachBefore((t=>{t.x<a.x&&(a=t),t.x>o.x&&(o=t)}));const s=o.x-a.x+this.config.svg.margin.top+this.config.svg.margin.bottom,u=this.svg.transition().duration(n).attr("height",s).attr("viewBox",[-this.config.svg.margin.left,a.x-this.config.svg.margin.top,this.config.svg.width,s]).tween("resize",window.ResizeObserver?null:()=>()=>this.svg.dispatch("toggle")),l=this.gNode.selectAll("g").data(r,(t=>t.id)),c=l.enter().append("g").attr("transform",`translate(${e.y0},${e.x0})`).attr("class","node").attr("taxNodeID",(t=>t.data.taxNodeID)).on("click",((t,e)=>{e.children=e.children?null:e._children,this.update(t,e)}));c.append("circle").attr("class","node-circle").attr("r",5),c.insert("text").attr("class","node-text-bg").attr("dy","0.31em").attr("text-anchor","start").attr("x","0.5rem").text((t=>t.data.name)),c.append("text").attr("class","node-text").attr("dy","0.31em").attr("stroke-linejoin","round").attr("text-anchor","start").attr("x","0.5rem").text((t=>t.data.name)),l.merge(c).transition(u).attr("transform",(t=>`translate(${this.config.node.columnWidth*t.data.level},${t.x})`)).attr("fill-opacity",1).attr("stroke-opacity",1),l.exit().transition(u).remove().attr("transform",`translate(${e.y0},${e.x0})`).attr("fill-opacity",0).attr("stroke-opacity",0);const h=this.gLink.selectAll("path").data(i,(t=>t.target.id)),f=h.enter().append("path").attr("d",(t=>{const e=this.config.node.columnWidth*t.source.data.level,n=this.config.node.columnWidth*t.target.data.level;return this.diagonal({source:[t.source.x,e],target:[t.target.x,n]})}));h.merge(f).transition(u).attr("d",(t=>{const e=this.config.node.columnWidth*t.source.data.level,n=this.config.node.columnWidth*t.target.data.level;return this.diagonal({source:[t.source.x,e],target:[t.target.x,n]})})),h.exit().transition(u).remove().attr("d",this.diagonal({source:[e.x,e.y],target:[e.x,e.y]})),this.root.eachBefore((t=>{t.x0=t.x,t.y0=t.y})),this.gLegend.selectAll(".legend-text").attr("transform",((t,e)=>(console.log("d = ",t,", i = ",e),"matrix(1,0,0,1, 0, 0)")))}}self.ICTV_VisualBrowser=e})();